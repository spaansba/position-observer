<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description"
    content="The PositionObserver class provides a way to asynchronously observe changes in the position of a target element with the top-level document's viewport.">
  <meta name="keywords" content="Typescript,PositionObserver,position-observer">
  <meta name="author" content="thednp">
  <title>PositionObserver</title>

  <!-- Bootstrap core CSS -->
  <link id="bsCSS" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="container">

  <div class="d-flex align-items-center mx-auto" style="padding: 40vh 3rem; margin: 50vh 0">
    <div>
      <h3>PositionObserver Example</h3>
      <div class="btn-toolbar mb-3">
        <button type="button" class="btn btn-warning me-1 mb-1" data-test="tooltip">Click</button>
      </div>
      <div>
        <div class="tooltip position-fixed d-none bs-tooltip-top" role="tooltip" style="top: 0px; left: 0px;">
          <div class="tooltip-arrow position-absolute" style="left: 93.5px;"></div>
          <div class="tooltip-inner">
            <b>Manual Tooltip</b>
            <span class="badge bg-success">NEW</span><br>
            Perhaps adding even more content would make the job more difficult? Nope, same as if this was a very very
            short tooltip. Efficiently unleash cross-media information without cross-media value. Quickly maximize
            timely deliverables for real-time schemas.
          </div>
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    import PositionObserver from '../src/index';
    import styleTip from '../test/styleTip';
    window.PositionObserver = PositionObserver;

    const element = document.querySelector('[data-test="tooltip"]');
    const tooltip = document.querySelector('.tooltip');
    const arrow = tooltip.querySelector('.tooltip-arrow');
    const container = document.body;
    let isOpen = false;

    const observer = new PositionObserver(([entry]) => {
      console.log(entry);
      if (entry.isVisible) {
        update();
      }
    });
    const update = () => styleTip({ element, container, tooltip, arrow, _observer: observer });

    element.addEventListener('click', (e) => {
      if (isOpen) {
        tooltip.classList.remove('show');
        tooltip.classList.add('d-none');
        observer.disconnect();
      } else {
        tooltip.classList.remove('d-none');
        tooltip.classList.add('show');
        update();
        observer.observe(element);
      }
      isOpen = !isOpen;
    })

  </script>

</body>

</html>